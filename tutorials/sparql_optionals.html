<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <link href="/css/jena.css" rel="stylesheet" type="text/css">

  <title>Apache Jena - SPARQL Tutorial - Optional Information</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="/js/jena-navigation.js" type="text/javascript"></script>
</head>

<body>
  <div id="header">
    <div id="logoblock">
    <img alt="Apache Jena" src="/images/jena-logo/jena-logo-small.png"/>
    </div>

    <div id="titleblock">
      <h1 class="title">Apache Jena</h1>
      <div id="topmenu" class="tabbar round-10">
        <ul>
        <li class="round-top-8"><a class="round-top-8" href="/index.html" id="home_menu">Home</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/help_and_support/index.html">Support</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/getting_started/index.html">Getting started</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/tutorials/index.html">Tutorials</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/documentation/index.html">Documentation</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div id="navigation" class="clear">
  <h1 id="quick-links">Quick links</h1>
<ul>
<li><a href="/index.html">Home</a></li>
<li><a href="/download/index.html">Downloads</a></li>
<li><a href="/help_and_support/index.html">Help and support</a></li>
<li><a href="/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
<li><a href="/about_jena/roadmap.html">Roadmap</a></li>
<li><a href="/getting_involved/index.html">Getting involved</a></li>
<li><a href="/documentation/">Documentation</a></li>
</ul>
<h1 id="about-jena">About Jena</h1>
<ul>
<li><a href="/index.html">Home</a></li>
<li><a href="/about_jena/about.html">About Jena</a></li>
<li><a href="/about_jena/architecture.html">Architecture</a></li>
<li><a href="/about_jena/roadmap.html">Roadmap</a></li>
<li><a href="/about_jena/team.html">Project team</a></li>
<li><a href="/about_jena/contributions.html">Related projects</a></li>
</ul>
<h1 id="download">Download</h1>
<ul>
<li><a href="/download/index.html">Downloading Jena</a></li>
<li><a href="/download/maven.html">Using Maven</a></li>
<li><a href="/download/osgi.html">Using OSGi</a></li>
</ul>
<h1 id="help-and-support">Help and support</h1>
<ul>
<li><a href="/help_and_support/index.html">Getting help</a></li>
<li><a href="/help_and_support/bugs_and_suggestions.html">Bugs and suggestions</a></li>
</ul>
<h1 id="getting-started">Getting Started</h1>
<ul>
<li><a href="/getting_started/index.html">A first Jena project</a></li>
<li><a href="/getting_started/rdf_api.html">RDF API overview</a></li>
<li><a href="/getting_started/sparql.html">Querying RDF with SPARQL</a></li>
<li><a href="/getting_started/fuseki.html">Serving RDF over HTTP</a></li>
<li><a href="/getting_started/tell_me_how.html">Tell me how to ...</a></li>
</ul>
<h1 id="tutorials">Tutorials</h1>
<ul>
<li><a href="/tutorials/index.html">Tutorials index</a></li>
<li><a href="/tutorials/rdf_api.html">RDF tutorial</a></li>
<li><a href="/tutorials/sparql.html">SPARQL queries</a></li>
<li><a href="/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
</ul>
<h1 id="documentation">Documentation</h1>
<ul>
<li><a href="/documentation/index.html">Overview</a></li>
<li><a href="/documentation/javadoc/">Javadoc</a></li>
<li><a href="/documentation/rdf/index.html">RDF</a></li>
<li><a href="/documentation/io/index.html">I/O</a></li>
<li><a href="/documentation/query/index.html">SPARQL (ARQ)</a><ul>
<li><a href="/documentation/query/app_api.html">Application API</a></li>
<li><a href="/documentation/query/cmds.html">Command line utilities</a></li>
</ul>
</li>
<li><a href="/documentation/query/text-query.html">Text Search</a></li>
<li><a href="/documentation/tdb/index.html">TDB</a><ul>
<li><a href="/documentation/tdb/tdb_transactions.html">API for Transactions</a></li>
<li><a href="/documentation/tdb/assembler.html">Dataset Assembler</a></li>
</ul>
</li>
<li><a href="/documentation/serving_data/index.html">Fuseki: Serving Data</a></li>
<li><a href="/documentation/ontology/index.html">Ontology</a></li>
<li><a href="/documentation/inference/index.html">Inference</a></li>
<li><a href="/documentation/assembler/index.html">Assembler</a><ul>
<li><a href="/documentation/assembler/assembler-howto.html">Assembler how-to</a></li>
<li><a href="/documentation/assembler/inside-assemblers.html">Inside assemblers</a></li>
</ul>
</li>
<li><a href="/documentation/sdb/index.html">SDB</a></li>
<li><a href="/documentation/notes/index.html">Notes</a><ul>
<li><a href="/documentation/notes/concurrency-howto.html">Concurrency how-to</a></li>
<li><a href="/documentation/notes/event-handler-howto.html">Event handler how-to</a></li>
<li><a href="/documentation/notes/file-manager.html">File manager how-to</a></li>
<li><a href="/documentation/notes/model-factory.html">Model factory how-to</a></li>
<li><a href="/documentation/notes/rdf-frames.html">RDF frames</a></li>
<li><a href="/documentation/notes/reification.html">Reification how-to</a></li>
<li><a href="/documentation/notes/typed-literals.html">Typed literals how-to</a></li>
<li><a href="/documentation/notes/iri.html">Support for IRI's</a></li>
<li><a href="/documentation/notes/sse.html">SSE</a></li>
</ul>
</li>
<li><a href="/documentation/tools/index.html">Tools</a><ul>
<li><a href="/documentation/tools/schemagen.html">schemagen</a></li>
<li><a href="/documentation/tools/eyeball-getting-started.html">eyeball</a></li>
</ul>
</li>
</ul>
<h1 id="getting-involved">Getting Involved</h1>
<ul>
<li><a href="/getting_involved/index.html">Contributing to Jena</a><ul>
<li><a href="/getting_involved/reviewing_contributions.html">Reviewing Contributions</a></li>
</ul>
</li>
</ul>
<h1 id="asf-links">ASF links</h1>
<ul>
<li><a href="http://www.apache.org">Apache Software Foundation</a></li>
<li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
<li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
<li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
<li><a href="http://www.apache.org/security/">Security</a></li>
</ul>
  </div>

  <div id="content">
    <h1 class="title">SPARQL Tutorial - Optional Information</h1>
    <p>RDF is semi-structured data so SPARQL has a the ability to query
for data but not to fail query when that data does not exist. The
query is using an optional part to extend the information found in
a query solution but to return the non-optional information
anyway.</p>
<h2 id="optionals">OPTIONALs</h2>
<p>This query (<a href="sparql_data/q-opt1.rq">q-opt1.rq</a>) gets the name of a person and
also their age if that piece of information is available.</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">info</span><span class="o">:</span>    <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//somewhere/peopleInfo#&gt;</span>
<span class="n">PREFIX</span> <span class="n">vcard</span><span class="o">:</span>   <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span> <span class="o">?</span><span class="n">age</span>
<span class="n">WHERE</span>
<span class="p">{</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">vcard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">.</span>
    <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">person</span> <span class="n">info</span><span class="o">:</span><span class="n">age</span> <span class="o">?</span><span class="n">age</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Two of the four people in the data (<a href="sparql_data/vc-db-2.rdf">vc-db-2.rdf</a>)have
age properties so two of the query solutions have that
information.Â  However, because the triple pattern for the age is
optional, there is a pattern solution for the people who don't have
age information.</p>
<div class="codehilite"><pre><span class="o">------------------------</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">age</span> <span class="o">|</span>
<span class="o">=======================</span>
<span class="o">|</span> <span class="s">&quot;Becky Smith&quot;</span> <span class="o">|</span> <span class="mi">23</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Sarah Jones&quot;</span> <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;John Smith&quot;</span>  <span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Matt Jones&quot;</span>  <span class="o">|</span>     <span class="o">|</span>
<span class="o">-----------------------</span>
</pre></div>


<p>If the optional clause had not been there, no age information would
have been retrieved. If the triple pattern had been included but
not optional then we would have the query
(<a href="sparql_data/q-opt2.rq">q-opt2.rq</a>):</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">info</span><span class="o">:</span>   <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//somewhere/peopleInfo#&gt;</span>
<span class="n">PREFIX</span> <span class="n">vcard</span><span class="o">:</span>  <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span> <span class="o">?</span><span class="n">age</span>
<span class="n">WHERE</span>
<span class="p">{</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">vcard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">.</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">info</span><span class="o">:</span><span class="n">age</span> <span class="o">?</span><span class="n">age</span> <span class="p">.</span>
<span class="p">}</span>
</pre></div>


<p>with only two solutions:</p>
<div class="codehilite"><pre><span class="o">-----------------------</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">age</span> <span class="o">|</span>
<span class="o">=======================</span>
<span class="o">|</span> <span class="s">&quot;Becky Smith&quot;</span> <span class="o">|</span> <span class="mi">23</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;John Smith&quot;</span>  <span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span>
<span class="o">-----------------------</span>
</pre></div>


<p>because the <code>info:age</code> property must now be present in a solution.</p>
<h2 id="optionals-with-filters">OPTIONALs with FILTERs</h2>
<p><code>OPTIONAL</code> is a binary operator that combines two graph patterns.
The optional pattern is any group pattern and may involve any
SPARQL pattern types.Â  If the group matches, the solution is
extended, if not, the original solution is given
(<a href="sparql_data/q-opt3.rq">q-opt-3.rq</a>).</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">info</span><span class="o">:</span>        <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//somewhere/peopleInfo#&gt;</span>
<span class="n">PREFIX</span> <span class="n">vcard</span><span class="o">:</span>      <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span> <span class="o">?</span><span class="n">age</span>
<span class="n">WHERE</span>
<span class="p">{</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">vcard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">.</span>
    <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">person</span> <span class="n">info</span><span class="o">:</span><span class="n">age</span> <span class="o">?</span><span class="n">age</span> <span class="p">.</span> <span class="n">FILTER</span> <span class="p">(</span> <span class="o">?</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">24</span> <span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>So, if we filter for ages greater than 24 in the optional part, we
will still get 4 solutions (from the <code>vcard:FN</code> pattern) but only
get ages if they pass the test.</p>
<div class="codehilite"><pre><span class="o">-----------------------</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">age</span> <span class="o">|</span>
<span class="o">=======================</span>
<span class="o">|</span> <span class="s">&quot;Becky Smith&quot;</span> <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Sarah Jones&quot;</span> <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;John Smith&quot;</span>  <span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Matt Jones&quot;</span>  <span class="o">|</span>     <span class="o">|</span>
<span class="o">-----------------------</span>
</pre></div>


<p>No age included for "Becky Smith" because it is less than 24.</p>
<p>If the filter condition is moved out of the optional part, then it
can influence the number of solutions but it may be necessary to
make the filter more complicated to allow for variable <code>age</code> being
unbound (<a href="sparql_data/q-opt4.rq">q-opt4.rq</a>).</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">info</span><span class="o">:</span>        <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//somewhere/peopleInfo#&gt;</span>
<span class="n">PREFIX</span> <span class="n">vcard</span><span class="o">:</span>      <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span> <span class="o">?</span><span class="n">age</span>
<span class="n">WHERE</span>
<span class="p">{</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">vcard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">.</span>
    <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">person</span> <span class="n">info</span><span class="o">:</span><span class="n">age</span> <span class="o">?</span><span class="n">age</span> <span class="p">.</span> <span class="p">}</span>
    <span class="n">FILTER</span> <span class="p">(</span> <span class="o">!</span><span class="n">bound</span><span class="p">(</span><span class="o">?</span><span class="n">age</span><span class="p">)</span> <span class="o">||</span> <span class="o">?</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">24</span> <span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>If a solution has an <code>age</code> variable, then it must be greater than
24. It can also be unbound.Â  There are now three solutions:</p>
<div class="codehilite"><pre><span class="o">-----------------------</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">age</span> <span class="o">|</span>
<span class="o">=======================</span>
<span class="o">|</span> <span class="s">&quot;Sarah Jones&quot;</span> <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;John Smith&quot;</span>  <span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Matt Jones&quot;</span>  <span class="o">|</span>     <span class="o">|</span>
<span class="o">-----------------------</span>
</pre></div>


<p>Evaluating an expression which has an unbound variables where a
bound one was expected causes an evaluation exception and the whole
expression fails.</p>
<h2 id="optionals-and-order-dependent-queries">OPTIONALs and Order Dependent Queries</h2>
<p>One thing to be careful of is using the same variable in two or
more optional clauses (and not in some basic pattern as well):</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">foaf</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//xmlns.com/foaf/0.1/&gt;</span>
<span class="n">PREFIX</span> <span class="n">vCard</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span>
<span class="n">WHERE</span>
<span class="p">{</span>
  <span class="o">?</span><span class="n">x</span> <span class="n">a</span> <span class="n">foaf</span><span class="o">:</span><span class="n">Person</span> <span class="p">.</span>
  <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">x</span> <span class="n">foaf</span><span class="o">:</span><span class="n">name</span> <span class="o">?</span><span class="n">name</span> <span class="p">}</span>
  <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">x</span> <span class="n">vCard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>If the first optional binds <code>?name</code> and <code>?x</code> to some values, the
second <code>OPTIONAL</code> is an attempt to match the ground triples (<code>?x</code>
and <code>&lt;kbd&gt;?name&lt;/kbd&gt;</code> have values). If the first optional did not
match the optional part, then the second one is an attempt to match
it's triple with two variables.</p>
<p><a href="sparql_union.html">Next: union queries</a></p>
  </div>

  <div id="footer">
    <div class="copyright">
      <p>
        Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        <br />
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
      </p>
    </div>
  </div>

</body>
</html>
