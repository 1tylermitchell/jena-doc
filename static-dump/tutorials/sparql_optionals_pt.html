<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <link href="/css/jena.css" rel="stylesheet" type="text/css">

  <title>Apache Jena - Tutorial SPARQL - Informações Opcionais</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="/js/jena-navigation.js" type="text/javascript"></script>
</head>

<body>
  <div id="header">
    <div id="logoblock">
    <img alt="Apache Jena" src="/images/jena-logo/jena-logo-small.png"/>
    </div>

    <div id="titleblock">
      <h1 class="title">Apache Jena</h1>
      <div id="topmenu" class="tabbar round-10">
        <ul>
        <li class="round-top-8"><a class="round-top-8" href="/index.html" id="home_menu">Home</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/help_and_support/index.html">Support</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/getting_started/index.html">Getting started</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/tutorials/index.html">Tutorials</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/documentation/index.html">Documentation</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div id="navigation" class="clear">
  <h1 id="quick-links">Quick links</h1>
<ul>
<li><a href="/index.html">Home</a></li>
<li><a href="/download/index.html">Downloads</a></li>
<li><a href="/help_and_support/index.html">Help and support</a></li>
<li><a href="/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
<li><a href="/about_jena/roadmap.html">Roadmap</a></li>
<li><a href="/getting_involved/index.html">Getting involved</a></li>
<li><a href="/documentation/">Documentation</a></li>
</ul>
<h1 id="about-jena">About Jena</h1>
<ul>
<li><a href="/index.html">Home</a></li>
<li><a href="/about_jena/about.html">About Jena</a></li>
<li><a href="/about_jena/architecture.html">Architecture</a></li>
<li><a href="/about_jena/roadmap.html">Roadmap</a></li>
<li><a href="/about_jena/team.html">Project team</a></li>
<li><a href="/about_jena/contributions.html">Related projects</a></li>
</ul>
<h1 id="download">Download</h1>
<ul>
<li><a href="/download/index.html">Downloading Jena</a></li>
<li><a href="/download/maven.html">Using Maven</a></li>
<li><a href="/download/osgi.html">Using OSGi</a></li>
</ul>
<h1 id="help-and-support">Help and support</h1>
<ul>
<li><a href="/help_and_support/index.html">Getting help</a></li>
<li><a href="/help_and_support/bugs_and_suggestions.html">Bugs and suggestions</a></li>
</ul>
<h1 id="getting-started">Getting Started</h1>
<ul>
<li><a href="/getting_started/index.html">A first Jena project</a></li>
<li><a href="/getting_started/rdf_api.html">RDF API overview</a></li>
<li><a href="/getting_started/sparql.html">Querying RDF with SPARQL</a></li>
<li><a href="/getting_started/fuseki.html">Serving RDF over HTTP</a></li>
<li><a href="/getting_started/tell_me_how.html">Tell me how to ...</a></li>
</ul>
<h1 id="tutorials">Tutorials</h1>
<ul>
<li><a href="/tutorials/index.html">Tutorials index</a></li>
<li><a href="/tutorials/rdf_api.html">RDF tutorial</a></li>
<li><a href="/tutorials/sparql.html">SPARQL queries</a></li>
<li><a href="/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
</ul>
<h1 id="documentation">Documentation</h1>
<ul>
<li><a href="/documentation/index.html">Overview</a></li>
<li><a href="/documentation/javadoc/">Javadoc</a></li>
<li><a href="/documentation/rdf/index.html">RDF</a></li>
<li><a href="/documentation/io/index.html">I/O</a></li>
<li><a href="/documentation/query/index.html">SPARQL (ARQ)</a><ul>
<li><a href="/documentation/query/app_api.html">Application API</a></li>
<li><a href="/documentation/query/cmds.html">Command line utilities</a></li>
</ul>
</li>
<li><a href="/documentation/query/text-query.html">Text Search</a></li>
<li><a href="/documentation/tdb/index.html">TDB</a><ul>
<li><a href="/documentation/tdb/tdb_transactions.html">API for Transactions</a></li>
<li><a href="/documentation/tdb/assembler.html">Dataset Assembler</a></li>
</ul>
</li>
<li><a href="/documentation/serving_data/index.html">Fuseki: Serving Data</a></li>
<li><a href="/documentation/ontology/index.html">Ontology</a></li>
<li><a href="/documentation/inference/index.html">Inference</a></li>
<li><a href="/documentation/assembler/index.html">Assembler</a><ul>
<li><a href="/documentation/assembler/assembler-howto.html">Assembler how-to</a></li>
<li><a href="/documentation/assembler/inside-assemblers.html">Inside assemblers</a></li>
</ul>
</li>
<li><a href="/documentation/sdb/index.html">SDB</a></li>
<li><a href="/documentation/notes/index.html">Notes</a><ul>
<li><a href="/documentation/notes/concurrency-howto.html">Concurrency how-to</a></li>
<li><a href="/documentation/notes/event-handler-howto.html">Event handler how-to</a></li>
<li><a href="/documentation/notes/file-manager.html">File manager how-to</a></li>
<li><a href="/documentation/notes/model-factory.html">Model factory how-to</a></li>
<li><a href="/documentation/notes/rdf-frames.html">RDF frames</a></li>
<li><a href="/documentation/notes/reification.html">Reification how-to</a></li>
<li><a href="/documentation/notes/typed-literals.html">Typed literals how-to</a></li>
<li><a href="/documentation/notes/iri.html">Support for IRI's</a></li>
<li><a href="/documentation/notes/sse.html">SSE</a></li>
</ul>
</li>
<li><a href="/documentation/tools/index.html">Tools</a><ul>
<li><a href="/documentation/tools/schemagen.html">schemagen</a></li>
<li><a href="/documentation/tools/eyeball-getting-started.html">eyeball</a></li>
</ul>
</li>
</ul>
<h1 id="getting-involved">Getting Involved</h1>
<ul>
<li><a href="/getting_involved/index.html">Contributing to Jena</a><ul>
<li><a href="/getting_involved/reviewing_contributions.html">Reviewing Contributions</a></li>
</ul>
</li>
</ul>
<h1 id="asf-links">ASF links</h1>
<ul>
<li><a href="http://www.apache.org">Apache Software Foundation</a></li>
<li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
<li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
<li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
<li><a href="http://www.apache.org/security/">Security</a></li>
</ul>
  </div>

  <div id="content">
    <h1 class="title">Tutorial SPARQL - Informações Opcionais</h1>
    <p>RDF é dado semi-estruturado então SPARQL tem a habilidade de consultá-lo, mas não para falhar quando o dado não existe. A consulta usa uma parte opcional para extender a informação encontrada na solução de uma consulta, mas para retornar a informação não opcional de qualquer maneira.</p>
<h2 id="opicionais">OPICIONAIS</h2>
<p>Essa consulta (<a href="sparql_data/q-opt1.rq">q-opt1.rq</a>) pega o nome da pessoa e também sua idade se essa informação estiver disponível.</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">info</span><span class="o">:</span>    <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//somewhere/peopleInfo#&gt;</span>
<span class="n">PREFIX</span> <span class="n">vcard</span><span class="o">:</span>   <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span> <span class="o">?</span><span class="n">age</span>
<span class="n">WHERE</span>
<span class="p">{</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">vcard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">.</span>
    <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">person</span> <span class="n">info</span><span class="o">:</span><span class="n">age</span> <span class="o">?</span><span class="n">age</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Duas das quatro pessoas nos dados (<a href="sparql_data/vc-db-2.rdf">vc-db-2.rdf</a>) possui a propriedade idade, então duas das soluções da consulta têm essa informação. No entanto, já que o padrão de tripla para a idade é opcional, há uma solução padrão para a pessoa que não tiver informação sobre a idade.</p>
<div class="codehilite"><pre><span class="o">------------------------</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">age</span> <span class="o">|</span>
<span class="o">=======================</span>
<span class="o">|</span> <span class="s">&quot;Becky Smith&quot;</span> <span class="o">|</span> <span class="mi">23</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Sarah Jones&quot;</span> <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;John Smith&quot;</span>  <span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Matt Jones&quot;</span>  <span class="o">|</span>     <span class="o">|</span>
<span class="o">-----------------------</span>
</pre></div>


<p>Se a clausula opcional não estivesse ali, nenhuma informação sobre idade seria retornada. Se o padrão da tripla fosse incluída, mas não fosse opcional, nós teríamos a consulta (<a href="sparql_data/q-opt2.rq">q-opt2.rq</a>):</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">info</span><span class="o">:</span>   <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//somewhere/peopleInfo#&gt;</span>
<span class="n">PREFIX</span> <span class="n">vcard</span><span class="o">:</span>  <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span> <span class="o">?</span><span class="n">age</span>
<span class="n">WHERE</span>
<span class="p">{</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">vcard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">.</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">info</span><span class="o">:</span><span class="n">age</span> <span class="o">?</span><span class="n">age</span> <span class="p">.</span>
<span class="p">}</span>
</pre></div>


<p>com os dois únicos resultados:</p>
<div class="codehilite"><pre><span class="o">-----------------------</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">age</span> <span class="o">|</span>
<span class="o">=======================</span>
<span class="o">|</span> <span class="s">&quot;Becky Smith&quot;</span> <span class="o">|</span> <span class="mi">23</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;John Smith&quot;</span>  <span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span>
<span class="o">-----------------------</span>
</pre></div>


<p>porque a propriedade <code>info:age</code> deve estar presente na solução agora.   </p>
<h2 id="opcionais-com-filtros">OPCIONAIS com FILTROS</h2>
<p><code>OPTIONAL</code> é um operador binário que combina dois padrões de grafo. O padrão opcional é qualquer padrão de grupo e deve envolver qualquer tipo de padrão SPARQL. Se o grupo casar, a solução é estendida, senão, a solução original é dada (<a href="sparql_data/q-opt3.rq">q-opt-3.rq</a>).</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">info</span><span class="o">:</span>        <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//somewhere/peopleInfo#&gt;</span>
<span class="n">PREFIX</span> <span class="n">vcard</span><span class="o">:</span>      <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span> <span class="o">?</span><span class="n">age</span>
<span class="n">WHERE</span>
<span class="p">{</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">vcard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">.</span>
    <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">person</span> <span class="n">info</span><span class="o">:</span><span class="n">age</span> <span class="o">?</span><span class="n">age</span> <span class="p">.</span> <span class="n">FILTER</span> <span class="p">(</span> <span class="o">?</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">24</span> <span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Portanto, se filtrarmos por idades maiores que 24 na parte opcional, nós ainda teremos quatro soluções (do padrão <code>vcard:FN</code>) mas somente pegaremos idades se elas passarem no teste.</p>
<div class="codehilite"><pre><span class="o">-----------------------</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">age</span> <span class="o">|</span>
<span class="o">=======================</span>
<span class="o">|</span> <span class="s">&quot;Becky Smith&quot;</span> <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Sarah Jones&quot;</span> <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;John Smith&quot;</span>  <span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Matt Jones&quot;</span>  <span class="o">|</span>     <span class="o">|</span>
<span class="o">-----------------------</span>
</pre></div>


<p>Idade não incluída para  "Becky Smith"  porque é menor que 24.</p>
<p>Se a condição do filtro é movida para a parte opcional, então isso pode influenciar no número de soluções, mas deve ser necessário fazer um filtro mais complicado para permitir que a varíavel <code>age</code> seja não limitada (<a href="sparql_data/q-opt4.rq">q-opt4.rq</a>).</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">info</span><span class="o">:</span>        <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//somewhere/peopleInfo#&gt;</span>
<span class="n">PREFIX</span> <span class="n">vcard</span><span class="o">:</span>      <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span> <span class="o">?</span><span class="n">age</span>
<span class="n">WHERE</span>
<span class="p">{</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">vcard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">.</span>
    <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">person</span> <span class="n">info</span><span class="o">:</span><span class="n">age</span> <span class="o">?</span><span class="n">age</span> <span class="p">.</span> <span class="p">}</span>
    <span class="n">FILTER</span> <span class="p">(</span> <span class="o">!</span><span class="n">bound</span><span class="p">(</span><span class="o">?</span><span class="n">age</span><span class="p">)</span> <span class="o">||</span> <span class="o">?</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">24</span> <span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>Se a solução tiver uma varíavel <code>age</code>, então ela deve ser maior que 24. Isso também pode ser não limitado. Agora há 3 soluções:</p>
<div class="codehilite"><pre><span class="o">-----------------------</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">age</span> <span class="o">|</span>
<span class="o">=======================</span>
<span class="o">|</span> <span class="s">&quot;Sarah Jones&quot;</span> <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;John Smith&quot;</span>  <span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Matt Jones&quot;</span>  <span class="o">|</span>     <span class="o">|</span>
<span class="o">-----------------------</span>
</pre></div>


<p>Avaliar uma expressão que tem variáveis não limitadas onde uma variável limitada é esperada causa uma exceção de avaliação e toda a expressão falha.    </p>
<h2 id="opcionais-e-consultas-dependentes-de-ordem">OPCIONAIS e consultas dependentes de ordem</h2>
<p>Uma coisa a se ter cuidado ao usar a mesma varíavel em duas ou mais clausulas opcionais (e não em alguma padrão básico também):</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">foaf</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//xmlns.com/foaf/0.1/&gt;</span>
<span class="n">PREFIX</span> <span class="n">vCard</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span>
<span class="n">WHERE</span>
<span class="p">{</span>
  <span class="o">?</span><span class="n">x</span> <span class="n">a</span> <span class="n">foaf</span><span class="o">:</span><span class="n">Person</span> <span class="p">.</span>
  <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">x</span> <span class="n">foaf</span><span class="o">:</span><span class="n">name</span> <span class="o">?</span><span class="n">name</span> <span class="p">}</span>
  <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">x</span> <span class="n">vCard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Se a primeira opção liga <code>?name</code> e <code>?x</code> a algum valor, a segunda opção é uma tentativa de casar as outras triplas (<code>?x</code> e <code>&lt;kbd&gt;?name&lt;/kbd&gt;</code> têm valor). Se a primeira opção não casar com a parte opcional, então a segunda é uma tentativa para casar a tripla com duas variáveis.</p>
<p><a href="sparql_union_pt.html">Próximo: União de Consultas</a></p>
  </div>

  <div id="footer">
    <div class="copyright">
      <p>
        Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        <br />
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
      </p>
    </div>
  </div>

</body>
</html>
