<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <link href="/css/jena.css" rel="stylesheet" type="text/css">

  <title>Apache Jena - SAX Input into Jena and ARP</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="/js/jena-navigation.js" type="text/javascript"></script>
</head>

<body>
  <div id="header">
    <div id="logoblock">
    <img alt="Apache Jena" src="/images/jena-logo/jena-logo-small.png"/>
    </div>

    <div id="titleblock">
      <h1 class="title">Apache Jena</h1>
      <div id="topmenu" class="tabbar round-10">
        <ul>
        <li class="round-top-8"><a class="round-top-8" href="/index.html" id="home_menu">Home</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/help_and_support/index.html">Support</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/getting_started/index.html">Getting started</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/tutorials/index.html">Tutorials</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/documentation/index.html">Documentation</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div id="navigation" class="clear">
  <h1 id="quick-links">Quick links</h1>
<ul>
<li><a href="/index.html">Home</a></li>
<li><a href="/download/index.html">Downloads</a></li>
<li><a href="/help_and_support/index.html">Help and support</a></li>
<li><a href="/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
<li><a href="/about_jena/roadmap.html">Roadmap</a></li>
<li><a href="/getting_involved/index.html">Getting involved</a></li>
<li><a href="/documentation/">Documentation</a></li>
</ul>
<h1 id="about-jena">About Jena</h1>
<ul>
<li><a href="/index.html">Home</a></li>
<li><a href="/about_jena/about.html">About Jena</a></li>
<li><a href="/about_jena/architecture.html">Architecture</a></li>
<li><a href="/about_jena/roadmap.html">Roadmap</a></li>
<li><a href="/about_jena/team.html">Project team</a></li>
<li><a href="/about_jena/contributions.html">Related projects</a></li>
</ul>
<h1 id="download">Download</h1>
<ul>
<li><a href="/download/index.html">Downloading Jena</a></li>
<li><a href="/download/maven.html">Using Maven</a></li>
<li><a href="/download/osgi.html">Using OSGi</a></li>
</ul>
<h1 id="help-and-support">Help and support</h1>
<ul>
<li><a href="/help_and_support/index.html">Getting help</a></li>
<li><a href="/help_and_support/bugs_and_suggestions.html">Bugs and suggestions</a></li>
</ul>
<h1 id="getting-started">Getting Started</h1>
<ul>
<li><a href="/getting_started/index.html">A first Jena project</a></li>
<li><a href="/getting_started/rdf_api.html">RDF API overview</a></li>
<li><a href="/getting_started/sparql.html">Querying RDF with SPARQL</a></li>
<li><a href="/getting_started/fuseki.html">Serving RDF over HTTP</a></li>
<li><a href="/getting_started/tell_me_how.html">Tell me how to ...</a></li>
</ul>
<h1 id="tutorials">Tutorials</h1>
<ul>
<li><a href="/tutorials/index.html">Tutorials index</a></li>
<li><a href="/tutorials/rdf_api.html">RDF tutorial</a></li>
<li><a href="/tutorials/sparql.html">SPARQL queries</a></li>
<li><a href="/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
</ul>
<h1 id="documentation">Documentation</h1>
<ul>
<li><a href="/documentation/index.html">Overview</a></li>
<li><a href="/documentation/javadoc/">Javadoc</a></li>
<li><a href="/documentation/rdf/index.html">RDF</a></li>
<li><a href="/documentation/io/index.html">I/O</a></li>
<li><a href="/documentation/query/index.html">SPARQL (ARQ)</a><ul>
<li><a href="/documentation/query/app_api.html">Application API</a></li>
<li><a href="/documentation/query/cmds.html">Command line utilities</a></li>
</ul>
</li>
<li><a href="/documentation/query/text-query.html">Text Search</a></li>
<li><a href="/documentation/tdb/index.html">TDB</a><ul>
<li><a href="/documentation/tdb/tdb_transactions.html">API for Transactions</a></li>
<li><a href="/documentation/tdb/assembler.html">Dataset Assembler</a></li>
</ul>
</li>
<li><a href="/documentation/serving_data/index.html">Fuseki: Serving Data</a></li>
<li><a href="/documentation/ontology/index.html">Ontology</a></li>
<li><a href="/documentation/inference/index.html">Inference</a></li>
<li><a href="/documentation/assembler/index.html">Assembler</a><ul>
<li><a href="/documentation/assembler/assembler-howto.html">Assembler how-to</a></li>
<li><a href="/documentation/assembler/inside-assemblers.html">Inside assemblers</a></li>
</ul>
</li>
<li><a href="/documentation/sdb/index.html">SDB</a></li>
<li><a href="/documentation/notes/index.html">Notes</a><ul>
<li><a href="/documentation/notes/concurrency-howto.html">Concurrency how-to</a></li>
<li><a href="/documentation/notes/event-handler-howto.html">Event handler how-to</a></li>
<li><a href="/documentation/notes/file-manager.html">File manager how-to</a></li>
<li><a href="/documentation/notes/model-factory.html">Model factory how-to</a></li>
<li><a href="/documentation/notes/rdf-frames.html">RDF frames</a></li>
<li><a href="/documentation/notes/reification.html">Reification how-to</a></li>
<li><a href="/documentation/notes/typed-literals.html">Typed literals how-to</a></li>
<li><a href="/documentation/notes/iri.html">Support for IRI's</a></li>
<li><a href="/documentation/notes/sse.html">SSE</a></li>
</ul>
</li>
<li><a href="/documentation/tools/index.html">Tools</a><ul>
<li><a href="/documentation/tools/schemagen.html">schemagen</a></li>
<li><a href="/documentation/tools/eyeball-getting-started.html">eyeball</a></li>
</ul>
</li>
</ul>
<h1 id="getting-involved">Getting Involved</h1>
<ul>
<li><a href="/getting_involved/index.html">Contributing to Jena</a><ul>
<li><a href="/getting_involved/reviewing_contributions.html">Reviewing Contributions</a></li>
</ul>
</li>
</ul>
<h1 id="asf-links">ASF links</h1>
<ul>
<li><a href="http://www.apache.org">Apache Software Foundation</a></li>
<li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
<li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
<li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
<li><a href="http://www.apache.org/security/">Security</a></li>
</ul>
  </div>

  <div id="content">
    <h1 class="title">SAX Input into Jena and ARP</h1>
    <p>Normally, both ARP and Jena are used to read files either from the
local machine or from the Web. A different use case, addressed
here, is when the XML source is available in-memory in some way. In
these cases, ARP and Jena can be used as a SAX event handler,
turning SAX events into triples, or a DOM tree can be parsed into a
Jena Model.</p>
<h2 id="contents">Contents</h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#sample-code">Sample Code</a></li>
<li><a href="#initializing-sax-event-source">Initializing SAX event source</a></li>
<li><a href="#error-handler">Error Handler</a></li>
<li><a href="#options">Options</a></li>
<li><a href="#xml-lang-and-namespaces">XML Lang and Namespaces</a></li>
<li><a href="#using-your-own-triple-handler">Using your own triple handler</a></li>
<li><a href="#using-a-dom-as-input">Using a DOM as input</a></li>
</ul>
<h2 id="1-overview">1. Overview</h2>
<p>To read an arbitrary SAX source as triples to be added into a Jena
model, it is not possible to use a
<code>Model.</code><a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/model/Model.html#read(java.io.InputStream,%20java.lang.String)"><code>read</code></a>()
operation. Instead, you construct a SAX event handler of class
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2Model.html"><code>SAX2Model</code></a>,
using the
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2Model.html#create(java.lang.String,%20com.hp.hpl.jena.rdf.model.Model)"><code>create</code></a>
method, install these as the handler on your SAX event source, and
then stream the SAX events. It is possible to have fine-grained
control over the SAX events, for instance, by inserting or deleting
events, before passing them to the
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2Model.html"><code>SAX2Model</code></a>
handler.</p>
<h2 id="sample-code">Sample Code</h2>
<p>This code uses the Xerces parser as a SAX event stream, and adds
the triple to a
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/model/Model.html"><code>Model</code></a> using
default options.</p>
<div class="codehilite"><pre><span class="c1">// Use your own SAX source.</span>
<span class="n">XMLReader</span> <span class="n">saxParser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SAXParser</span><span class="p">();</span>

<span class="c1">// set up SAX input</span>
<span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="s">&quot;kb.rdf&quot;</span><span class="p">);</span>
<span class="n">InputSource</span> <span class="n">ins</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputSource</span><span class="p">(</span><span class="n">in</span><span class="p">);</span>
<span class="n">ins</span><span class="p">.</span><span class="n">setSystemId</span><span class="p">(</span><span class="n">base</span><span class="p">);</span>

<span class="n">Model</span> <span class="n">m</span> <span class="o">=</span> <span class="n">ModelFactory</span><span class="p">.</span><span class="n">createDefaultModel</span><span class="p">();</span>
<span class="n">String</span> <span class="n">base</span> <span class="o">=</span> <span class="s">&quot;http://example.org/&quot;</span><span class="p">;</span>

<span class="c1">// create handler, linked to Model</span>
<span class="n">SAX2Model</span> <span class="n">handler</span> <span class="o">=</span> <span class="n">SAX2Model</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>

<span class="c1">// install handler on SAX event stream</span>
<span class="no">SAX2RDF</span><span class="p">.</span><span class="n">installHandlers</span><span class="p">(</span><span class="n">saxParser</span><span class="p">,</span> <span class="n">handler</span><span class="p">);</span>

<span class="n">try</span> <span class="p">{</span>
    <span class="n">try</span> <span class="p">{</span>
        <span class="n">saxParser</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">ins</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">finally</span> <span class="p">{</span>
        <span class="c1">// MUST ensure handler is closed.</span>
        <span class="n">handler</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">SAXParseException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Fatal parsing errors end here,</span>
    <span class="c1">// but they will already have been reported.</span>
<span class="p">}</span>
</pre></div>


<h2 id="initializing-sax-event-source">Initializing SAX event source</h2>
<p>If your SAX event source is a subclass of <code>XMLReader</code>, then the
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2RDF.html#installHandlers(org.xml.sax.XMLReader,%20com.hp.hpl.jena.rdf.arp.XMLHandler)">installHandlers</a>
static method can be used as shown in the sample. Otherwise, you
have to do it yourself. The
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2RDF.html#installHandlers(org.xml.sax.XMLReader,%20com.hp.hpl.jena.rdf.arp.XMLHandler)"><code>installHandlers</code></a>
code is like this:</p>
<div class="codehilite"><pre><span class="k">static</span> <span class="n">public</span> <span class="kt">void</span> <span class="nf">installHandlers</span><span class="p">(</span><span class="n">XMLReader</span> <span class="n">rdr</span><span class="p">,</span> <span class="n">XMLHandler</span> <span class="n">sax2rdf</span><span class="p">)</span>
<span class="n">throws</span> <span class="n">SAXException</span>
<span class="p">{</span>
    <span class="n">rdr</span><span class="p">.</span><span class="n">setEntityResolver</span><span class="p">(</span><span class="n">sax2rdf</span><span class="p">);</span>
    <span class="n">rdr</span><span class="p">.</span><span class="n">setDTDHandler</span><span class="p">(</span><span class="n">sax2rdf</span><span class="p">);</span>
    <span class="n">rdr</span><span class="p">.</span><span class="n">setContentHandler</span><span class="p">(</span><span class="n">sax2rdf</span><span class="p">);</span>
    <span class="n">rdr</span><span class="p">.</span><span class="n">setErrorHandler</span><span class="p">(</span><span class="n">sax2rdf</span><span class="p">);</span>
    <span class="n">rdr</span><span class="p">.</span><span class="n">setFeature</span><span class="p">(</span><span class="s">&quot;http://xml.org/sax/features/namespaces&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="n">rdr</span><span class="p">.</span><span class="n">setFeature</span><span class="p">(</span>
            <span class="s">&quot;http://xml.org/sax/features/namespace-prefixes&quot;</span><span class="p">,</span>
            <span class="nb">true</span><span class="p">);</span>
    <span class="n">rdr</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span>
            <span class="s">&quot;http://xml.org/sax/properties/lexical-handler&quot;</span><span class="p">,</span>
            <span class="n">sax2rdf</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>For some other SAX source, the exact code will differ, but the
required operations are as above.</p>
<h2 id="error-handler">Error Handler</h2>
<p>The <a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2Model.html">SAX2Model</a>
handler supports the
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/model/RDFReader.html#setErrorHandler(com.hp.hpl.jena.rdf.model.RDFErrorHandler)">setErrorHandler</a>
method, from the Jena
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/model/RDFReader.html">RDFReader</a>
interface. This is used in the same way as that method to control
error reporting.</p>
<p>A specific fatal error, new in Jena 2.3, is ERR_INTERRUPTED, which
indicates that the current Thread received an interrupt. This
allows long jobs to be aborted on user request.</p>
<h2 id="options">Options</h2>
<p>The <a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2Model.html"><code>SAX2Model</code></a>
handler supports the
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/model/RDFReader.html#setProperty(java.lang.String,%20java.lang.Object)"><code>setProperty</code></a>
method, from the Jena
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/model/RDFReader.html"><code>RDFReader</code></a>
interface. This is used in nearly the same way to have fine grain
control over ARPs behaviour, particularly over error reporting, see
the <a href="iohowto.html#arp_properties">I/O howto</a>. Setting SAX or
Xerces properties cannot be done using this method.</p>
<h2 id="xml-lang-and-namespaces">XML Lang and Namespaces</h2>
<p>If you are only treating some document subset as RDF/XML then it is
necessary to ensure that ARP knows the correct value for <code>xml:lang</code>
and desirable that it knows the correct mappings of namespace
prefixes.</p>
<p>There is a second version of the
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2Model.html#create(java.lang.String,%20com.hp.hpl.jena.rdf.model.Model,%20java.lang.String)"><code>create</code></a>
method, which allows specification of the <code>xml:lang</code> value from the
outer context. If this is inappropriate it is possible, but hard
work, to synthesis an appropriate SAX event.</p>
<p>For the namespaces prefixes, it is possible to call the
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2RDF.html#startPrefixMapping(java.lang.String,%20java.lang.String)"><code>startPrefixMapping</code></a>
SAX event, before passing the other SAX events, to declare each
namespace, one by one. Failure to do this is permitted, but, for
instance, a Jena Model will then not know the (advisory) namespace
prefix bindings. These should be paired with endPrefixMapping
events, but nothing untoward is likely if such code is omitted.</p>
<h2 id="using-your-own-triple-handler">Using your own triple handler</h2>
<p>As with ARP, it is possible to use this functionality, without
using other Jena features, in particular, without using a Jena
Model. Instead of using the class SAX2Model, you use its superclass
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2RDF.html">SAX2RDF</a>. The
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2RDF.html#create(java.lang.String)">create</a>
method on this class does not provide any means of specifying what
to do with the triples. Instead, the class implements the
<a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2RDF.html">ARPConfig</a>
interface, which permits the setting of handlers and parser
options, as described in the documentation for using
<a href="standalone.html">ARP without Jena</a>.</p>
<p>Thus you need to:</p>
<ol>
<li>Create a SAX2RDF using
    <a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/SAX2RDF.html#create(java.lang.String)">SAX2RDF.create()</a></li>
<li>Attach your StatementHandler and SAXErrorHandler and optionally
    your NamespaceHandler and ExtendedHandler to the SAX2RDF instance.</li>
<li>Install the SAX2RDF instance as the SAX handler on your SAX
    source.</li>
<li>Follow the remainder of the code sample above.</li>
</ol>
<h2 id="using-a-dom-as-input">Using a DOM as Input</h2>
<p>None of the approaches listed here work with Java 1.4.1_04. We
suggest using Java 1.4.2_04 or greater for this functionality.
This issue has no impact on any other Jena functionality.</p>
<h3 id="using-a-dom-as-input-to-jena">Using a DOM as Input to Jena</h3>
<p>The <a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/DOM2Model.html"><code>DOM2Model</code></a>
subclass of SAX2Model, allows the parsing of a DOM using ARP. The
procedure to follow is:</p>
<ul>
<li>Construct a <code>DOM2Model</code>, using a factory method such as
    <a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/DOM2Model.html#createD2M(java.lang.String,%20com.hp.hpl.jena.rdf.model.Model)"><code>createD2M</code></a>,
    specifying the xml:base of the document to be loaded, the Model to
    load into, optionally the xml:lang value (particularly useful if
    using a DOM Node from within a Document).</li>
<li>Set any properties, error handlers etc. on the <code>DOM2Model</code>
    object.</li>
<li>The DOM is parsed simply by calling the
    <a href="/documentation/javadoc/jena/com/hp/hpl/jena/rdf/arp/DOM2Model.html#load(org.w3c.dom.Node)"><code>load(Node)</code></a>
    method.</li>
</ul>
<h3 id="using-a-dom-as-input-to-arp">Using a DOM as Input to ARP</h3>
<p>DOM2Model is a subclass of SAX2RDF, and handlers etc. can be set on
the DOM2Model as for SAX2RDF. Using a null model as the argument to
the factory indicates this usage.</p>
  </div>

  <div id="footer">
    <div class="copyright">
      <p>
        Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        <br />
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
      </p>
    </div>
  </div>

</body>
</html>
