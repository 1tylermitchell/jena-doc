<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <link href="/css/jena.css" rel="stylesheet" type="text/css">

  <title>Apache Jena - ARQ - Aggregates</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="/js/jena-navigation.js" type="text/javascript"></script>
</head>

<body>
  <div id="header">
    <div id="logoblock">
    <img alt="Apache Jena" src="/images/jena-logo/jena-logo-small.png"/>
    </div>

    <div id="titleblock">
      <h1 class="title">Apache Jena</h1>
      <div id="topmenu" class="tabbar round-10">
        <ul>
        <li class="round-top-8"><a class="round-top-8" href="/index.html" id="home_menu">Home</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/help_and_support/index.html">Support</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/getting_started/index.html">Getting started</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/tutorials/index.html">Tutorials</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/documentation/index.html">Documentation</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div id="navigation" class="clear">
  <h1 id="quick-links">Quick links</h1>
<ul>
<li><a href="/index.html">Home</a></li>
<li><a href="/download/index.html">Downloads</a></li>
<li><a href="/help_and_support/index.html">Help and support</a></li>
<li><a href="/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
<li><a href="/about_jena/roadmap.html">Roadmap</a></li>
<li><a href="/getting_involved/index.html">Getting involved</a></li>
<li><a href="/documentation/">Documentation</a></li>
</ul>
<h1 id="about-jena">About Jena</h1>
<ul>
<li><a href="/index.html">Home</a></li>
<li><a href="/about_jena/about.html">About Jena</a></li>
<li><a href="/about_jena/architecture.html">Architecture</a></li>
<li><a href="/about_jena/roadmap.html">Roadmap</a></li>
<li><a href="/about_jena/team.html">Project team</a></li>
<li><a href="/about_jena/contributions.html">Related projects</a></li>
</ul>
<h1 id="download">Download</h1>
<ul>
<li><a href="/download/index.html">Downloading Jena</a></li>
<li><a href="/download/maven.html">Using Maven</a></li>
<li><a href="/download/osgi.html">Using OSGi</a></li>
</ul>
<h1 id="help-and-support">Help and support</h1>
<ul>
<li><a href="/help_and_support/index.html">Getting help</a></li>
<li><a href="/help_and_support/bugs_and_suggestions.html">Bugs and suggestions</a></li>
</ul>
<h1 id="getting-started">Getting Started</h1>
<ul>
<li><a href="/getting_started/index.html">A first Jena project</a></li>
<li><a href="/getting_started/rdf_api.html">RDF API overview</a></li>
<li><a href="/getting_started/sparql.html">Querying RDF with SPARQL</a></li>
<li><a href="/getting_started/fuseki.html">Serving RDF over HTTP</a></li>
<li><a href="/getting_started/tell_me_how.html">Tell me how to ...</a></li>
</ul>
<h1 id="tutorials">Tutorials</h1>
<ul>
<li><a href="/tutorials/index.html">Tutorials index</a></li>
<li><a href="/tutorials/rdf_api.html">RDF tutorial</a></li>
<li><a href="/tutorials/sparql.html">SPARQL queries</a></li>
<li><a href="/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
</ul>
<h1 id="documentation">Documentation</h1>
<ul>
<li><a href="/documentation/index.html">Overview</a></li>
<li><a href="/documentation/javadoc/">Javadoc</a></li>
<li><a href="/documentation/rdf/index.html">RDF</a></li>
<li><a href="/documentation/io/index.html">I/O</a></li>
<li><a href="/documentation/query/index.html">SPARQL (ARQ)</a><ul>
<li><a href="/documentation/query/app_api.html">Application API</a></li>
<li><a href="/documentation/query/cmds.html">Command line utilities</a></li>
</ul>
</li>
<li><a href="/documentation/query/text-query.html">Text Search</a></li>
<li><a href="/documentation/tdb/index.html">TDB</a><ul>
<li><a href="/documentation/tdb/tdb_transactions.html">API for Transactions</a></li>
<li><a href="/documentation/tdb/assembler.html">Dataset Assembler</a></li>
</ul>
</li>
<li><a href="/documentation/serving_data/index.html">Fuseki: Serving Data</a></li>
<li><a href="/documentation/ontology/index.html">Ontology</a></li>
<li><a href="/documentation/inference/index.html">Inference</a></li>
<li><a href="/documentation/assembler/index.html">Assembler</a><ul>
<li><a href="/documentation/assembler/assembler-howto.html">Assembler how-to</a></li>
<li><a href="/documentation/assembler/inside-assemblers.html">Inside assemblers</a></li>
</ul>
</li>
<li><a href="/documentation/sdb/index.html">SDB</a></li>
<li><a href="/documentation/notes/index.html">Notes</a><ul>
<li><a href="/documentation/notes/concurrency-howto.html">Concurrency how-to</a></li>
<li><a href="/documentation/notes/event-handler-howto.html">Event handler how-to</a></li>
<li><a href="/documentation/notes/file-manager.html">File manager how-to</a></li>
<li><a href="/documentation/notes/model-factory.html">Model factory how-to</a></li>
<li><a href="/documentation/notes/rdf-frames.html">RDF frames</a></li>
<li><a href="/documentation/notes/reification.html">Reification how-to</a></li>
<li><a href="/documentation/notes/typed-literals.html">Typed literals how-to</a></li>
<li><a href="/documentation/notes/iri.html">Support for IRI's</a></li>
<li><a href="/documentation/notes/sse.html">SSE</a></li>
</ul>
</li>
<li><a href="/documentation/tools/index.html">Tools</a><ul>
<li><a href="/documentation/tools/schemagen.html">schemagen</a></li>
<li><a href="/documentation/tools/eyeball-getting-started.html">eyeball</a></li>
</ul>
</li>
</ul>
<h1 id="getting-involved">Getting Involved</h1>
<ul>
<li><a href="/getting_involved/index.html">Contributing to Jena</a><ul>
<li><a href="/getting_involved/reviewing_contributions.html">Reviewing Contributions</a></li>
</ul>
</li>
</ul>
<h1 id="asf-links">ASF links</h1>
<ul>
<li><a href="http://www.apache.org">Apache Software Foundation</a></li>
<li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
<li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
<li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
<li><a href="http://www.apache.org/security/">Security</a></li>
</ul>
  </div>

  <div id="content">
    <h1 class="title">ARQ - Aggregates</h1>
    <p>ARQ includes support for GROUP BY and counting.  This was previously an ARQ extension but is now legal SPARQL 1.1</p>
<h2 id="group-by">GROUP BY</h2>
<p>A <code>GROUP BY</code> clause transforms a result set so that only one row
will appear for each unique set of grouping variables. All other
variables from the query pattern are projected away and are not
available in the <code>SELECT</code> clause.</p>
<div class="codehilite"><pre><span class="n">PREFIX</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">p</span> <span class="o">?</span><span class="n">q</span>
<span class="p">{</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
<span class="p">}</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="o">?</span><span class="n">p</span> <span class="o">?</span><span class="n">q</span>
</pre></div>


<p><code>SELECT *</code> will include variables from the <code>GROUP BY</code> but no
others. This ensures that results are always the same - including
other variables from the pattern would involve choosing some value
that was not constant across each section of the group and so lead
to indeterminate results.</p>
<p>The <code>GROUP BY</code> clause can involve an expression. If the expression
is named, then the value is included in the columns, before
projection. An unnamed expression is used for grouping but the
value is not placed in the result set formed by the <code>GROUP BY</code>
clause.</p>
<div class="codehilite"><pre><span class="n">SELECT</span> <span class="o">?</span><span class="n">productId</span> <span class="o">?</span><span class="n">cost</span>
<span class="p">{</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
<span class="p">}</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="o">?</span><span class="n">productId</span> <span class="p">(</span><span class="o">?</span><span class="n">num</span> <span class="o">*</span> <span class="o">?</span><span class="n">price</span> <span class="n">AS</span> <span class="o">?</span><span class="n">cost</span><span class="p">)</span>
</pre></div>


<h2 id="having">HAVING</h2>
<p>A query may specify a HAVING clause to apply a filter to the result
set after grouping. The filter may involve variables from the
<code>GROUP BY</code> clause or aggregations.</p>
<div class="codehilite"><pre><span class="n">SELECT</span> <span class="o">?</span><span class="n">p</span> <span class="o">?</span><span class="n">q</span>
<span class="p">{</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
<span class="p">}</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="o">?</span><span class="n">p</span> <span class="o">?</span><span class="n">q</span>
<span class="n">HAVING</span> <span class="p">(</span><span class="n">count</span><span class="p">(</span><span class="n">distinct</span> <span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<h2 id="aggregation">Aggregation</h2>
<p>Currently supported aggregations:</p>
<table>
<thead>
<tr>
<th>Aggregator</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>count(*)</code></td>
<td>Count rows of each group element, or the whole result set if no <code>GROUP BY</code>.</td>
</tr>
<tr>
<td><code>count(distinct *)</code></td>
<td>Count the distinct rows of each group element, or the whole result set if no <code>GROUP BY</code>.</td>
</tr>
<tr>
<td><code>count(?var)</code></td>
<td>Count the number of times <code>?var</code> is bound in a group.</td>
</tr>
<tr>
<td><code>count(distinct ?var)</code></td>
<td>Count the number of distinct values <code>?var</code> is bound to in a group.</td>
</tr>
<tr>
<td><code>sum(?x)</code></td>
<td>Sum the variable over the group (non-numeric values and unbound values are ignored).</td>
</tr>
</tbody>
</table>
<p>When a variable is used, what is being counted is occurrences of
RDF terms, that is names. It is not a count of individuals because
two names can refer to the same individual.</p>
<p>If there was no explicit <code>GROUP BY</code> clause, then it is as if the
whole of the result set forms a single group element. 
Equivalently, it is <code>GROUP BY</code> of no variables. Only aggregation
expressions make sense in the SELECT clause as theer are no
variables from the query pattern to project out.</p>
<p><a href="index.html">ARQ documentation index</a></p>
  </div>

  <div id="footer">
    <div class="copyright">
      <p>
        Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        <br />
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
      </p>
    </div>
  </div>

</body>
</html>
