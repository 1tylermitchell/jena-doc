<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <link href="/jena-doc/css/jena.css" rel="stylesheet" type="text/css">

  <title>Apache Jena - ARQ - Logging</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="/js/jena-navigation.js" type="text/javascript"></script>
</head>

<body>
  <div id="header">
    <div id="logoblock">
    <img alt="Apache Jena" src="/images/jena-logo/jena-logo-small.png"/>
    </div>

    <div id="titleblock">
      <h1 class="title">Apache Jena</h1>
      <div id="topmenu" class="tabbar round-10">
        <ul>
        <li class="round-top-8"><a class="round-top-8" href="/jena-doc/index.html" id="home_menu">Home</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/jena-doc/help_and_support/index.html">Support</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/jena-doc/getting_started/index.html">Getting started</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/jena-doc/tutorials/index.html">Tutorials</a></li>
        <li class="round-top-8"><a class="round-top-8" href="/jena-doc/documentation/index.html">Documentation</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div id="navigation" class="clear">
  <h1 id="quick-links">Quick links</h1>
<ul>
<li><a href="/jena-doc/index.html">Home</a></li>
<li><a href="/jena-doc/download/index.html">Downloads</a></li>
<li><a href="/jena-doc/help_and_support/index.html">Help and support</a></li>
<li><a href="/jena-doc/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
<li><a href="/jena-doc/about_jena/roadmap.html">Roadmap</a></li>
<li><a href="/jena-doc/getting_involved/index.html">Getting involved</a></li>
<li><a href="/jena-doc/documentation/">Documentation</a></li>
</ul>
<h1 id="about-jena">About Jena</h1>
<ul>
<li><a href="/jena-doc/index.html">Home</a></li>
<li><a href="/jena-doc/about_jena/about.html">About Jena</a></li>
<li><a href="/jena-doc/about_jena/architecture.html">Architecture</a></li>
<li><a href="/jena-doc/about_jena/roadmap.html">Roadmap</a></li>
<li><a href="/jena-doc/about_jena/team.html">Project team</a></li>
<li><a href="/jena-doc/about_jena/contributions.html">Related projects</a></li>
</ul>
<h1 id="download">Download</h1>
<ul>
<li><a href="/jena-doc/download/index.html">Downloading Jena</a></li>
<li><a href="/jena-doc/download/maven.html">Using Maven</a></li>
<li><a href="/jena-doc/download/osgi.html">Using OSGi</a></li>
</ul>
<h1 id="help-and-support">Help and support</h1>
<ul>
<li><a href="/jena-doc/help_and_support/index.html">Getting help</a></li>
<li><a href="/jena-doc/help_and_support/bugs_and_suggestions.html">Bugs and suggestions</a></li>
</ul>
<h1 id="getting-started">Getting Started</h1>
<ul>
<li><a href="/jena-doc/getting_started/index.html">A first Jena project</a></li>
<li><a href="/jena-doc/getting_started/rdf_api.html">RDF API overview</a></li>
<li><a href="/jena-doc/getting_started/sparql.html">Querying RDF with SPARQL</a></li>
<li><a href="/jena-doc/getting_started/fuseki.html">Serving RDF over HTTP</a></li>
<li><a href="/jena-doc/getting_started/tell_me_how.html">Tell me how to ...</a></li>
</ul>
<h1 id="tutorials">Tutorials</h1>
<ul>
<li><a href="/jena-doc/tutorials/index.html">Tutorials index</a></li>
<li><a href="/jena-doc/tutorials/rdf_api.html">RDF tutorial</a></li>
<li><a href="/jena-doc/tutorials/sparql.html">SPARQL queries</a></li>
<li><a href="/jena-doc/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
</ul>
<h1 id="documentation">Documentation</h1>
<ul>
<li><a href="/jena-doc/documentation/index.html">Overview</a></li>
<li><a href="/jena-doc/documentation/javadoc/">Javadoc</a></li>
<li><a href="/jena-doc/documentation/rdf/index.html">RDF</a></li>
<li><a href="/jena-doc/documentation/io/index.html">I/O</a></li>
<li><a href="/jena-doc/documentation/query/index.html">SPARQL (ARQ)</a><ul>
<li><a href="/jena-doc/documentation/query/app_api.html">Application API</a></li>
<li><a href="/jena-doc/documentation/query/cmds.html">Command line utilities</a></li>
</ul>
</li>
<li><a href="/jena-doc/documentation/query/text-query.html">Text Search</a></li>
<li><a href="/jena-doc/documentation/tdb/index.html">TDB</a><ul>
<li><a href="/jena-doc/documentation/tdb/tdb_transactions.html">API for Transactions</a></li>
<li><a href="/jena-doc/documentation/tdb/assembler.html">Dataset Assembler</a></li>
</ul>
</li>
<li><a href="/jena-doc/documentation/serving_data/index.html">Fuseki: Serving Data</a></li>
<li><a href="/jena-doc/documentation/ontology/index.html">Ontology</a></li>
<li><a href="/jena-doc/documentation/inference/index.html">Inference</a></li>
<li><a href="/jena-doc/documentation/assembler/index.html">Assembler</a><ul>
<li><a href="/jena-doc/documentation/assembler/assembler-howto.html">Assembler how-to</a></li>
<li><a href="/jena-doc/documentation/assembler/inside-assemblers.html">Inside assemblers</a></li>
</ul>
</li>
<li><a href="/jena-doc/documentation/sdb/index.html">SDB</a></li>
<li><a href="/jena-doc/documentation/notes/index.html">Notes</a><ul>
<li><a href="/jena-doc/documentation/notes/concurrency-howto.html">Concurrency how-to</a></li>
<li><a href="/jena-doc/documentation/notes/event-handler-howto.html">Event handler how-to</a></li>
<li><a href="/jena-doc/documentation/notes/file-manager.html">File manager how-to</a></li>
<li><a href="/jena-doc/documentation/notes/model-factory.html">Model factory how-to</a></li>
<li><a href="/jena-doc/documentation/notes/rdf-frames.html">RDF frames</a></li>
<li><a href="/jena-doc/documentation/notes/reification.html">Reification how-to</a></li>
<li><a href="/jena-doc/documentation/notes/typed-literals.html">Typed literals how-to</a></li>
<li><a href="/jena-doc/documentation/notes/iri.html">Support for IRI's</a></li>
<li><a href="/jena-doc/documentation/notes/sse.html">SSE</a></li>
</ul>
</li>
<li><a href="/jena-doc/documentation/tools/index.html">Tools</a><ul>
<li><a href="/jena-doc/documentation/tools/schemagen.html">schemagen</a></li>
<li><a href="/jena-doc/documentation/tools/eyeball-getting-started.html">eyeball</a></li>
</ul>
</li>
</ul>
<h1 id="getting-involved">Getting Involved</h1>
<ul>
<li><a href="/jena-doc/getting_involved/index.html">Contributing to Jena</a><ul>
<li><a href="/jena-doc/getting_involved/reviewing_contributions.html">Reviewing Contributions</a></li>
</ul>
</li>
</ul>
<h1 id="asf-links">ASF links</h1>
<ul>
<li><a href="http://www.apache.org">Apache Software Foundation</a></li>
<li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
<li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
<li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
<li><a href="http://www.apache.org/security/">Security</a></li>
</ul>
  </div>

  <div id="content">
    <h1 class="title">ARQ - Logging</h1>
    <p>ARQ uses
<a href="http://commons.apache.org/logging/">Apache Commons Logging</a>
as the API and ships with
<a href="http://logging.apache.org/log4j/docs/">Log4J</a> as a deployment
system.  You can use Java 1.4 logging instead.</p>
<p>ARQ does not output any logging messages at level INFO in normal
operation. The code uses level TRACE and DEBUG.  Running with
logging set to an application at INFO will cause no output in
normal operation. Output below INFO can be very verbose and is
intended mainly to help debug ARQ. WARN and FATAL messages are only
used when something is wrong.</p>
<p>The root of all the loggers is <code>com.hp.hpl.jena</code>.
<code>com.hp.hpl.jena.query</code> is the application API. 
<code>com.hp.hpl.jena.sparql</code> is the implementation and extensions
points.</p>
<p>If using in Tomcat, or other system that provides complex class
loading arrangements, be careful about loading from jars in both
the web application and the system directories as this can cause
separate logging systems to be created (this may not matter).</p>
<p>The ARQ and RIOT command line utilities look for a file
"log4j.properties" in the current directory to control logging during
command execution.</p>
<table>
<thead>
<tr>
<th>Logger Names</th>
<th>Name</th>
<th>Constant</th>
<th>Logger</th>
<th>Use</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>com.hp.hpl.jena.arq.info</code></td>
<td><code>ARQ.logInfoName</code></td>
<td><code>ARQ.getLoggerInfo()</code></td>
<td>General information</td>
<td></td>
</tr>
<tr>
<td><code>com.hp.hpl.jena.arq.exec</code></td>
<td><code>ARQ.logExecName</code></td>
<td><code>ARQ.getLoggerExec()</code></td>
<td>Execution information</td>
<td></td>
</tr>
</tbody>
</table>
<p>There is some code to cover simple situations. See the <a href="http://logging.apache.org/log4j/1.2/manual.html">log4j
documentation</a>
for full details of log4j.</p>
<p>The reading of <code>log4j.properties</code> from the current directory is achieved
by a call to <code>org.apache.jena.atlas.logging.Log.setlog4j()</code>.</p>
<p>Example log4j.properties file:</p>
<div class="codehilite"><pre><span class="n">log4j</span><span class="p">.</span><span class="n">rootLogger</span><span class="o">=</span><span class="n">INFO</span><span class="p">,</span> <span class="n">stdlog</span>

<span class="n">log4j</span><span class="p">.</span><span class="n">appender</span><span class="p">.</span><span class="n">stdlog</span><span class="o">=</span><span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">log4j</span><span class="p">.</span><span class="n">ConsoleAppender</span>
<span class="cp">## log4j.appender.stdlog.target=System.err</span>
<span class="n">log4j</span><span class="p">.</span><span class="n">appender</span><span class="p">.</span><span class="n">stdlog</span><span class="p">.</span><span class="n">layout</span><span class="o">=</span><span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">log4j</span><span class="p">.</span><span class="n">PatternLayout</span>
<span class="n">log4j</span><span class="p">.</span><span class="n">appender</span><span class="p">.</span><span class="n">stdlog</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">ConversionPattern</span><span class="o">=%</span><span class="n">d</span><span class="p">{</span><span class="n">HH</span><span class="o">:</span><span class="n">mm</span><span class="o">:</span><span class="n">ss</span><span class="p">}</span><span class="err"> </span><span class="o">%-</span><span class="mi">5</span><span class="n">p</span><span class="err"> </span><span class="o">%-</span><span class="mi">25</span><span class="n">c</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="err"> </span><span class="o">::</span><span class="err"> </span><span class="o">%</span><span class="n">m</span><span class="o">%</span><span class="n">n</span>

<span class="cp"># Execution logging</span>
<span class="n">log4j</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="n">hp</span><span class="p">.</span><span class="n">hpl</span><span class="p">.</span><span class="n">jena</span><span class="p">.</span><span class="n">arq</span><span class="p">.</span><span class="n">info</span><span class="o">=</span><span class="n">INFO</span>
<span class="n">log4j</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="n">hp</span><span class="p">.</span><span class="n">hpl</span><span class="p">.</span><span class="n">jena</span><span class="p">.</span><span class="n">arq</span><span class="p">.</span><span class="n">exec</span><span class="o">=</span><span class="n">INFO</span>

<span class="cp"># Other</span>
<span class="n">log4j</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="n">hp</span><span class="p">.</span><span class="n">hpl</span><span class="p">.</span><span class="n">jena</span><span class="o">=</span><span class="n">WARN</span>
<span class="n">log4j</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">jena</span><span class="o">=</span><span class="n">WARN</span>
</pre></div>


<p>A <a href="../serving/data/index.html">Fuseki</a>
server output can include <a href="explain.html" title="ARQ/Explain">ARQ execution logging</a>.</p>
<p>Note: ARQ performs some direct control of logging in the test suite and
depends on log4j to compile.</p>
<h2 id="execution-logging">Execution Logging</h2>
<p>ARQ can log query and update execution details globally or for an
individual operations. This adds another level of control on top of the
logger level controls.</p>
<p>Explanatory messages are controlled by the <code>Explain.InfoLevel</code> level in
the execution context.</p>
<p>The logger used is called <code>com.hp.hpl.jena.arq.exec</code>. Message are sent
at level "info". So for log4j, the following can be set in the
log4j.properties file:</p>
<div class="codehilite"><pre><span class="n">log4j</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">com</span><span class="p">.</span><span class="n">hp</span><span class="p">.</span><span class="n">hpl</span><span class="p">.</span><span class="n">jena</span><span class="p">.</span><span class="n">arq</span><span class="p">.</span><span class="n">exec</span><span class="o">=</span><span class="n">INFO</span>
</pre></div>


<p>The context setting is for key (Java constant) <code>ARQ.symLogExec</code>. To set
globally:</p>
<div class="codehilite"><pre><span class="n">ARQ</span><span class="p">.</span><span class="n">setExecutionLogging</span><span class="p">(</span><span class="n">Explain</span><span class="p">.</span><span class="n">InfoLevel</span><span class="p">.</span><span class="n">ALL</span><span class="p">)</span><span class="err"> </span><span class="p">;</span>
</pre></div>


<p>and it may also be set on an individual query execution using its local
context.</p>
<div class="codehilite"><pre> <span class="n">QueryExecutiuon</span> <span class="n">qExec</span> <span class="o">=</span> <span class="n">QueryExecutionFactory</span><span class="p">.</span><span class="n">create</span><span class="p">(...)</span><span class="err"> </span><span class="p">;</span>
 <span class="n">qExec</span><span class="p">.</span><span class="n">getContext</span><span class="p">().</span><span class="n">set</span><span class="p">(</span><span class="n">ARQ</span><span class="p">.</span><span class="n">symLogExec</span><span class="p">,</span> <span class="n">Explain</span><span class="p">.</span><span class="n">InfoLevel</span><span class="p">.</span><span class="n">ALL</span><span class="p">)</span><span class="err"> </span><span class="p">;</span>
</pre></div>


<p>On the command line:</p>
<div class="codehilite"><pre> <span class="n">arq</span><span class="p">.</span><span class="n">query</span> <span class="o">--</span><span class="n">explain</span> <span class="o">--</span><span class="n">data</span> <span class="n">data</span> <span class="n">file</span> <span class="o">--</span><span class="n">query</span><span class="o">=</span><span class="n">queryfile</span>
</pre></div>


<p>The command <code>tdbquery</code> takes the same <code>--explain</code> argument.</p>
<p><strong>Information levels</strong></p>
<table>
<thead>
<tr>
<th>Level</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td>INFO</td>
<td>Log each query</td>
</tr>
<tr>
<td>FINE</td>
<td>Log each query and its algebra form after optimization</td>
</tr>
<tr>
<td>ALL</td>
<td>Log query, algebra and every dataset access (can be expensive)</td>
</tr>
<tr>
<td>NONE</td>
<td>No information logged</td>
</tr>
</tbody>
</table>
<p>These can be specified as string, to the command line tools, or using
the constants in <code>Explain.InfoLevel</code>.</p>
<div class="codehilite"><pre> <span class="n">qExec</span><span class="p">.</span><span class="n">getContext</span><span class="p">().</span><span class="n">set</span><span class="p">(</span><span class="n">ARQ</span><span class="p">.</span><span class="n">symLogExec</span><span class="p">,</span> <span class="n">Explain</span><span class="p">.</span><span class="n">InfoLevel</span><span class="p">.</span><span class="n">FINE</span><span class="p">)</span><span class="err"> </span><span class="p">;</span>

 <span class="n">arq</span><span class="p">.</span><span class="n">query</span> <span class="o">--</span><span class="n">set</span> <span class="n">arq</span><span class="o">:</span><span class="n">logExec</span><span class="o">=</span><span class="n">FINE</span> <span class="o">--</span><span class="n">data</span> <span class="n">data</span> <span class="n">file</span> <span class="o">--</span><span class="n">query</span><span class="o">=</span><span class="n">queryfile</span>
</pre></div>


<p><a href="index.html">ARQ documentation index</a></p>
  </div>

  <div id="footer">
    <div class="copyright">
      <p>
        Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        <br />
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
      </p>
    </div>
  </div>

</body>
</html>
